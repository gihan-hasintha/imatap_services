<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check out this profile on ImaTAP!</title>
    <link rel="stylesheet" href="/css/style.css">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <link
    href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css"
    rel="stylesheet"
/>
<style>
.image-modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0; top: 0; width: 100vw; height: 100vh;
  background: rgba(0,0,0,0.85);
  justify-content: center;
  align-items: center;
}
.image-modal.open {
  display: flex;
}
</style>
<script>
    setTimeout(function() {
  document.getElementById("loader-show-hider").style.display = "block";
}, 2000); // 3000 milliseconds = 3 seconds

</script>
</head>
<body>

    <div id="loader">
        <div class="loader-content-sd">
            <div class="loader-content"> 
                <div class="loader-content-asdasd">
                    <div class="loader-img">
                        <img src="./assets/img/logo_f.webp" alt="">
                    </div>
                    <div class="loader-loader">
                        <div id="loader-show-hider" style="display: none;">
                            <div class="loader">
                                <div class="bar1"></div>
                                <div class="bar2"></div>
                                <div class="bar3"></div>
                                <div class="bar4"></div>
                                <div class="bar5"></div>
                                <div class="bar6"></div>
                                <div class="bar7"></div>
                                <div class="bar8"></div>
                                <div class="bar9"></div>
                                <div class="bar10"></div>
                                <div class="bar11"></div>
                                <div class="bar12"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="profile-bg"></div>
    <div class="main-card">
        <div class="photo-section-of-profile">
            <div class="photo-section-of-profile-cover" id="coverPhotoImg">
                <div class="avatar-wrapper">
                    <img class="avatar" id="avatarImg" src="" alt="Avatar">
                </div>
            </div>
        </div>
        <div class="space-for-profile-details"></div>
        <div class="profile-details">
            <div class="profile-name" id="profileName">Loading...</div>
            <div class="profile-intro" id="profile-working-top"></div>

            <div class="profile-details-buttons-for-contact">
                <div class="profile-details-buttons-for-contact-bt-db">
                    <a href="" id="personalcontactnumberphonecall">
                        <div class="profile-details-buttons-for-contact-bt-db-link-icon">
                            <img src="./assets/img/phone-call.png" alt="">
                        </div>
                        <div class="profile-details-buttons-for-contact-bt-db-txt">
                            Call me
                        </div>
                    </a>
                    <a href="" target="_blank" id="profilewhatsappnumber">
                        <div class="profile-details-buttons-for-contact-bt-db-link-icon">
                            <ion-icon name="logo-whatsapp"></ion-icon>
                        </div>
                        <div class="profile-details-buttons-for-contact-bt-db-txt">
                            Whatsapp
                        </div>
                    </a>
                </div>

                <div class="profile-details-buttons-for-contact-bt-db profile-details-buttons-for-contact-bt-dbfb">
                    <a href="" target="_blank" id="profilefacebooklink">
                        <div class="profile-details-buttons-for-contact-bt-db-link-icon">
                            <img src="./assets/img/facebook.png" alt="">
                        </div>
                        <div class="profile-details-buttons-for-contact-bt-db-txt">
                            View facebook profile
                        </div>
                    </a>
                </div>

            </div>
        </div>

        <div>



        </div>

        <div class="info-card" id="infoCard">
            <div class="tab-container" id="tabContainer">
                <button class="tab-button active" data-tab="home">Home</button>
                <button class="tab-button" id="contactTab" data-tab="Contact">Contact</button>
                <button class="tab-button" id="workTab" data-tab="Work">Work</button>
                <button class="tab-button" id="socialTab" data-tab="Social">Social</button>
                <div class="tab-underline" id="tabUnderline"></div>
              </div>
              
              <div id="home" class="tab-content active">
                <h3>About Me</h3>
                
            <div id="profileIntro"></div>

            <div id="gallerySection" class="gallery-section"></div>
              </div>
              <div id="Contact" class="tab-content">
                <h3>Contact</h3>
                <div id="contactInfo" class="info-category"></div>
              </div>
              <div id="Work" class="tab-content">
                <h3>Work</h3>
                <div id="workInfo" class="info-category" style="display:none"></div>
              </div>
              <div id="Social" class="tab-content">
                <h3>Social</h3>
                <div id="socialInfo" class="info-category" style="display:none"></div>
              </div>
            <div id="contactInfo" class="info-category">
            </div>
            <div id="workInfo" class="info-category" style="display:none"></div>
            <div id="socialInfo" class="info-category" style="display:none"></div>
        </div>
    </div>

    <div class="footer-space"></div>

    <div id="footer-profile">
        <div id="footer-section-on-account">
            <div class="footer-section-on-account-content">
                <a href="" id="personalcontactnumberphonecall">
                    <div class="profile-details-buttons-for-contact-bt-db-link-icon">
                        <img src="./assets/img/add-user.png" alt="">
                    </div>
                    <div class="profile-details-buttons-for-contact-bt-db-txt">
                        Contact Save
                    </div>
                </a>
                <a href="" target="_blank" id="profilewhatsappnumber">
                    <div class="profile-details-buttons-for-contact-bt-db-link-icon">
                        <img src="./assets/img/sharing.png" alt="">
                    </div>
                    <div class="profile-details-buttons-for-contact-bt-db-txt">
                        Contact Share
                    </div>
                </a>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
        import { initializeAppCheck, ReCaptchaV3Provider } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app-check.js";
        const firebaseConfig = {
            apiKey: "AIzaSyAjv12MJilOWARxoe_YqEXB9YZ2i1QMTd0",
            authDomain: "imatap.firebaseapp.com",
            projectId: "imatap",
            storageBucket: "imatap.firebasestorage.app",
            messagingSenderId: "385083217755",
            appId: "1:385083217755:web:83334c40989a9032c8ac7e",
            measurementId: "G-43CKB8XJBF"
        };
        const app = initializeApp(firebaseConfig);
        const appCheck = initializeAppCheck(app, {
          provider: new ReCaptchaV3Provider('6LdaQocrAAAAAEB7H0vhlojYmCpwpA_oN-lczPM2'),
          isTokenAutoRefreshEnabled: true
        });
        const db = getFirestore(app);
        function getIdFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        }
        function renderInfoCard(data) {
            document.getElementById('loader').style.display = "none";
            document.getElementById("personalcontactnumberphonecall").href = `tel:${data.phone}`;
            document.getElementById("profile-working-top").innerHTML = `${data.jobRole || ''} at ${data.company || ''}`;
            document.getElementById("profilewhatsappnumber").href = `https://wa.me/${data.whatsapp}?text=Hi%20there!%20I'm%20reaching%20out%20from%20ImaTap%20Card`;
            const facebookLinks = Array.isArray(data.social?.facebook) ? data.social.facebook : [];
            document.getElementById("profilefacebooklink").href = facebookLinks.length > 0 ? facebookLinks[0].url : "#";

            // List of supported social networks and their icons
            const socialNetworks = [
                { key: 'facebook', icon: './assets/img/facebook-logo.png', iconClass: 'infofidicfb', display: 'Facebook' },
                { key: 'tiktok', icon: './assets/img/tik-tok.png', iconClass: 'infofidictiktok', display: 'Tiktok' },
                { key: 'linkedin', icon: './assets/img/linkedin-logo.png', iconClass: 'infofidiclinkd', display: 'Linkedin' },
                { key: 'twitter', icon: './assets/img/twitter.png', iconClass: 'infofidicltwitter', display: 'X (Twitter)' },
                { key: 'youtube', icon: './assets/img/youtube.png', iconClass: 'infofidicltwyt', display: 'Youtube' },
                { key: 'behance', icon: './assets/img/facebook-logo.png', iconClass: '', display: 'Behance' },
                { key: 'github', icon: './assets/img/github.png', iconClass: 'infofidicltwytgithub', display: 'Github' },
                { key: 'instagram', icon: './assets/img/instagram.png', iconClass: 'infofidicltwytinstagrammrr', display: 'Instagram' }
            ];

            let socialHtml = '';
            let hasAnySocial = false;

            socialNetworks.forEach(network => {
                const links = Array.isArray(data.social?.[network.key]) ? data.social[network.key] : [];
                if (links.length > 0) {
                    hasAnySocial = true;
                    links.forEach(link => {
                        socialHtml += `
                            <div class="info-field">
                                <div class="info-field-content">
                                    <div class="info-field-icon ${network.iconClass}">
                                        <img src="${network.icon}" alt="">
                                    </div>
                                    <div class="info-field-txt">
                                        <a href="${link.url}" target="_blank" title="${network.display}">${network.display}${link.label ? ` (${link.label})` : ''}</a>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }
            });

            if (hasAnySocial) {
                socialHtml = `<div class="info-field socials">${socialHtml}</div>`;
            } else {
                socialHtml = `<div class="info-field">No social links provided.</div>`;
            }

            return {
                contact: `
                <div class="info-field">
                <div class="info-field-content">
                    <div class="info-field-icon">
                        <img src="./assets/img/email (1).png" alt="">
                    </div>
                    <div class="info-field-txt">${data.email || ''}</div>
                </div>
            </div>
            
            <div class="info-field">
                <div class="info-field-content">
                    <div class="info-field-icon">
                        <img src="./assets/img/call.png" alt="">
                    </div>
                    <div class="info-field-txt">
                        <a href="tel:${data.phone || ''}" target="_blank">${data.phone || ''}
                        </a>
                        </div>
                </div>
            </div>
            
            <div class="info-field">
                <div class="info-field-content">
                    <div class="info-field-icon">
                        <img src="./assets/img/telephone.png" alt="">
                    </div>
                    <div class="info-field-txt">
                        <a href="tel:${data.businessPhone || ''}" target="_blank">${data.businessPhone || ''}
                        </a>
                        </div>
                </div>
            </div>

            <div class="info-field">
                <div class="info-field-content info-field-contentaddresssection">
                    <div class="info-field-icon">
                        <img src="./assets/img/maps-and-flags.png" alt="">
                    </div>
                    <div class="info-field-txt">${data.address || ''}</div>
                </div>
            </div>

            <div class="info-field">
                <div class="info-field-content">
                    <div class="info-field-icon">
                        <img src="./assets/img/whatsapp.png" alt="">
                    </div>
                    <div class="info-field-txt">
                        <a href="https://wa.me/${data.whatsapp}?text=Hi%20there!%20I'm%20reaching%20out%20from%20ImaTap%20Card" target="_blank">${data.whatsapp || ''}
                        </a>
                        </div>
                </div>
            </div>

            ${data.website ? `
            <div class="info-field">
                <div class="info-field-content">
                    <div class="info-field-icon">
                        <img src="./assets/img/web.png" alt="">
                    </div>
                    <div class="info-field-txt">
                        <a href="${data.website}" target="_blank">${data.website}
                        </a>
                        </div>
                </div>
            </div>
            ` : ''}
                `,
                work: Array.isArray(data.experiences) && data.experiences.length > 0 ?
                    data.experiences.map(exp => `
                        <div class="info-field">
                            <div class="info-field-content">
                                <div class="info-field-icon">
                                    <img src="./assets/img/portfolio.png" alt="">
                                </div>
                                <div class="info-field-txt">${exp.jobRole || ''}${exp.company ? ` at ${exp.company}` : ''}</div>
                            </div>
                        </div>
                    `).join('')
                : `
            <div class="info-field">
                <div class="info-field-content">
                    <div class="info-field-icon">
                        <img src="./assets/img/portfolio.png" alt="">
                    </div>
                    <div class="info-field-txt">${data.jobRole || ''} at ${data.company || ''}</div>
                </div>
            </div>
                `,
                social: socialHtml
            };
        }
        async function loadAccount() {
            const id = getIdFromUrl();
            const avatarImg = document.getElementById('avatarImg');
            const coverPhotoImg = document.getElementById('coverPhotoImg');
            const profileName = document.getElementById('profileName');
            const profileIntro = document.getElementById('profileIntro');
            const infoCard = document.getElementById('infoCard');
            if (!id) {
                profileName.textContent = 'Account ID not specified.';
                return;
            }
            const docRef = doc(db, 'clients', id);
            const docSnap = await getDoc(docRef);
            if (!docSnap.exists()) {
                profileName.textContent = 'Account not found.';
                return;
            }
            const data = docSnap.data();
            window.loadedProfileData = data; // Store globally for vCard
            avatarImg.src = data.avatarUrl || '';
            coverPhotoImg.style.backgroundImage = data.coverPhotoUrl ? `url('${data.coverPhotoUrl}')` : '';
            profileName.textContent = data.fullName || '';
            profileIntro.textContent = data.shortBio || `Hi! My name is ${data.fullName || ''}. It's nice to meet you.`;
            const info = renderInfoCard(data);
            document.getElementById('contactInfo').innerHTML = info.contact;
            document.getElementById('workInfo').innerHTML = info.work;
            document.getElementById('socialInfo').innerHTML = info.social;
            const gallerySection = document.getElementById('gallerySection');
            if (Array.isArray(data.galleryUrls) && data.galleryUrls.length > 0) {
                gallerySection.innerHTML = `
                    <h3>Gallery Photos</h3>
                    <div class="gallery-photos">
                        ${data.galleryUrls.map(url => `<img src="${url}" class="gallery-photo" style="width:100%;height:150px;object-fit:cover;margin:8px;border-radius:8px;box-shadow:0 2px 8px #0001;">`).join('')}
                    </div>
                `;
            } else {
                gallerySection.innerHTML = '';
            }
        }
        loadAccount();
        // Tab switching (About/Gallery)
        document.getElementById('contactTab').addEventListener('click', function() {
            setActiveTab('contact');
        });
        document.getElementById('workTab').addEventListener('click', function() {
            setActiveTab('work');
        });
        document.getElementById('socialTab').addEventListener('click', function() {
            setActiveTab('social');
        });

        function setActiveTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
            document.querySelectorAll('.info-category').forEach(div => div.style.display = 'none');
            document.getElementById(tab + 'Info').style.display = '';
        }
        // vCard download for footer 'Contact Save' button
        document.querySelectorAll('#footer-profile #personalcontactnumberphonecall').forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const data = window.loadedProfileData;
                if (!data) return;
                let vcard = `BEGIN:VCARD\nVERSION:3.0\n`;
                vcard += `N:${data.lastName || ''};${data.firstName || ''};;;\n`;
                vcard += `FN:${data.fullName || ''}\n`;
                vcard += `ORG:${data.company || ''}\n`;
                vcard += `TITLE:${data.jobRole || ''}\n`;
                vcard += `TEL;TYPE=CELL:${data.phone || data.mobile || ''}\n`;
                vcard += `EMAIL:${data.email || ''}\n`;
                vcard += `ADR;TYPE=HOME:;;${data.address || ''};;;;\n`;
                if (data.website) vcard += `URL:${data.website}\n`;
                
                const socialNetworks = ['facebook', 'linkedin', 'twitter', 'github', 'instagram', 'youtube', 'tiktok'];
                socialNetworks.forEach(network => {
                    const links = Array.isArray(data.social?.[network]) ? data.social[network] : [];
                    links.forEach(link => {
                        if (link && link.url) {
                            vcard += `X-SOCIALPROFILE;type=${network}:${link.url}\n`;
                        }
                    });
                });
                
                vcard += `END:VCARD`;
                const blob = new Blob([vcard], { type: 'text/vcard' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = (data.fullName || 'contact') + '.vcf';
                document.body.appendChild(a);
                a.click();
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            });
        });
        // Share link for footer 'Contact Share' button
        document.querySelectorAll('#footer-profile #profilewhatsappnumber').forEach(function(btn) {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const data = window.loadedProfileData;
                if (!data) return;
                const shareText = data && data.fullName
                    ? `Check out ${data.fullName}'s profile on ImaTAP!`
                    : 'Check out this profile!';
                const shareData = {
                    title: document.title,
                    text: shareText,
                    url: window.location.href,
                };

                // Try to share image if supported
                if (navigator.canShare && data && data.avatarUrl) {
                    fetch(data.avatarUrl)
                        .then(response => response.blob())
                        .then(blob => {
                            const file = new File([blob], "avatar.jpg", { type: blob.type });
                            if (navigator.canShare({ files: [file] })) {
                                // Share with image
                                navigator.share({ ...shareData, files: [file] })
                                    .catch(() => { alert('Sharing failed.'); });
                            } else {
                                // Fallback: share without image
                                navigator.share(shareData)
                                    .catch(() => { alert('Sharing failed.'); });
                            }
                        })
                        .catch(() => {
                            // Fallback: share without image
                            navigator.share(shareData)
                                .catch(() => { alert('Sharing failed.'); });
                        });
                } else if (navigator.share) {
                    navigator.share(shareData)
                        .catch(() => { alert('Sharing failed.'); });
                } else {
                    alert('Sharing is not supported on this browser.');
                }
            });
        });
        // Modal logic for gallery images
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('gallery-photo')) {
                const modal = document.getElementById('imageModal');
                const modalImg = document.getElementById('modalImg');
                modalImg.src = e.target.src;
                modal.classList.add('open');
                modal.style.display = 'flex';
            }
            if (e.target.id === 'closeModal' || e.target.id === 'imageModal') {
                document.getElementById('imageModal').classList.remove('open');
                document.getElementById('imageModal').style.display = 'none';
            }
        });
        // Optional: close modal on ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.getElementById('imageModal').classList.remove('open');
                document.getElementById('imageModal').style.display = 'none';
            }
        });
    </script>
    <script src="./assets/js/script.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', function() {
            navigator.serviceWorker.register('/service-worker.js')
              .then(function(registration) {
                console.log('ServiceWorker registration successful:', registration.scope);
              }, function(err) {
                console.log('ServiceWorker registration failed:', err);
              });
          });
        }
        </script>
    <!-- Image Modal -->
    <div id="imageModal" class="image-modal" style="display:none;">
      <span class="close-modal" id="closeModal" style="position:absolute;top:20px;right:30px;font-size:40px;color:white;cursor:pointer;z-index:1001;">&times;</span>
      <img class="modal-content" id="modalImg" style="display:block;margin:auto;max-width:90vw;max-height:90vh;box-shadow:0 4px 32px #000a;border-radius:12px;">
    </div>
</body>
</html> 